`# 喫煙所マップWebアプリ作成

## 概要
Flutter WebとFirebaseを使った喫煙所共有マップアプリを作成してください。

## 技術スタック
- Flutter Web
- Firebase (Authentication, Firestore, Hosting, Storage)
- Google Maps API
- 状態管理: Riverpod

## アーキテクチャ
- MVVM パターン
- 状態管理: Riverpod
- レイヤー構成:
  - View: UIコンポーネント
  - ViewModel: ビジネスロジック・状態管理
  - Model: データモデル
  - Repository: Firebase連携処理

## 主要機能

### 1. 認証機能
- Firebase Authを使用（Cookie/LocalStorageで自動ログイン対応）
- 初回起動時にCookie使用同意バナー表示
- Google認証またはメール/パスワード認証
- 新規アカウント作成機能
- ログイン/ログアウト機能
- 自動ログイン機能（`authStateChanges()`で実装）

### 2. ゲストモード
- ログインなしで地図閲覧可能
- 投稿・コメント・評価はログイン必須
- アクション時に「ログインが必要です」ダイアログ表示

### 3. 画面構成・遷移`

起動
↓
Cookie同意バナー（初回のみ）
↓
Firebase Auth状態チェック
↓
├─ ログイン済み → Map画面（自動ログイン）
└─ 未ログイン → Map画面（ゲストモード）
└─ 右上に「ログイン/新規登録」ボタン配置

`### 4. 地図表示
- `google_maps_flutter_web`を使用
- 現在地表示
- 地図の表示範囲内の喫煙所のみをFirestoreから取得
- pinで喫煙所位置を表示

### 5. 喫煙所データ管理
- Firestoreに以下の情報を保存:
  - 座標（緯度経度 + geohash）
  - 喫煙所名
  - 種類（屋内/屋外）
  - 写真（Firebase Storage）
  - 評価・コメント
  - 投稿者情報
  - 投稿日時

### 6. 喫煙所追加機能
- ユーザーが地図上で位置を選択して喫煙所を追加
- 写真アップロード機能
- 基本情報入力フォーム
- ログインユーザーのみ利用可能

### 7. 検索・フィルター
- 現在地周辺検索
- 屋内/屋外フィルター

## 技術的要件

### 認証状態管理
- RiverpodのStreamProviderで`authStateChanges()`を監視
- ログイン状態を全画面で共有
- セッション情報はFirebase Authが自動管理

### Cookie同意
- 初回アクセス時にバナー表示
- 同意後はLocalStorageに記録
- 同意なしでもゲストモードで閲覧可能

### 地図データ取得の最適化
- `geoflutterfire_plus`パッケージを使用してgeohash検索
- 地図の表示範囲（LatLngBounds）内のデータのみ取得
- 取得上限を100件程度に設定
- 地図移動（パン/ズーム）時に再取得

### PWA対応
- マニフェストファイル設定
- ホーム画面追加対応

## デプロイ
- Firebase Hostingにデプロイ可能な状態で作成

## 初期状態
- 初期データは空でOK
- ユーザー投稿型で育てる想定

## 優先順位
1. 認証機能・自動ログイン・ゲストモード
2. 地図表示と範囲内データ取得
3. 喫煙所追加機能
4. 評価・コメント機能

プロジェクト構造も含めて、すぐにビルド・デプロイできる状態で作成してください。`